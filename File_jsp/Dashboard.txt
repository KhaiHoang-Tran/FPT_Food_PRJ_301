<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.util.List" %>
<%@ page import="java.util.ArrayList" %>


<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FPT Food - Dashboard Quản lý</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* --- GIỮ NGUYÊN CSS CŨ (Tớ rút gọn để tập trung vào logic) --- */
      :root { --primary: #ff6600; --bg-page: #f5f7fa; --text-dark: #333; --border-radius: 8px; --success: #28a745; --danger: #dc3545; --warning: #ffc107; }
      * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", sans-serif; }
      body { background-color: var(--bg-page); color: var(--text-dark); }
      .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
      header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); margin-bottom: 20px; }
      .brand h1 { color: var(--primary); font-size: 24px; } .brand p { font-size: 13px; color: #777; }
      .btn-logout { padding: 8px 15px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
      .nav-tabs { display: flex; background: #e9ecef; border-radius: 30px; padding: 5px; margin-bottom: 30px; }
      .tab-btn { flex: 1; border: none; background: transparent; padding: 12px; border-radius: 25px; cursor: pointer; font-weight: 600; color: #666; transition: 0.3s; }
      .tab-btn.active { background: white; color: var(--text-dark); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
      .tab-btn i { margin-right: 8px; }
      .section-content { display: none; animation: fadeIn 0.3s; } .section-content.active { display: block; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .table-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
      .table-card { background: white; border-radius: var(--border-radius); padding: 20px; border: 1px solid #eee; position: relative; }
      .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
      .badge { padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; color: white; }
      .badge.empty { background: var(--success); } .badge.busy { background: var(--danger); } .badge.booked { background: var(--warning); color: #333; }
      .form-select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd; background: #f9f9f9; margin-bottom: 15px; }
      .order-summary { background: #fff5f0; padding: 10px; border-radius: 6px; font-size: 13px; color: #555; }
      .order-total { font-weight: bold; color: var(--primary); margin-top: 5px; display: block; }
      .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
      .btn-add { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; }
      .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: var(--border-radius); overflow: hidden; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
      .data-table th, .data-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; } .data-table th { background: #f8f9fa; font-weight: 600; color: #555; }
      .action-btn { width: 32px; height: 32px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; margin-right: 5px; } .action-btn:hover { background: #f0f0f0; }
      .bill-card { background: white; border-radius: var(--border-radius); padding: 25px; margin-bottom: 20px; border: 1px solid #eee; }
      .bill-header { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; font-weight: bold; font-size: 18px; }
      .bill-item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
      .bill-total { display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-weight: bold; font-size: 18px; color: var(--primary); }
      .btn-pay { width: 100%; margin-top: 20px; padding: 12px; background: #28a745; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
  </head>
  <body>
    <header>
      <div class="brand">
        <h1>FPT Food - Dashboard</h1>
        <p>Xin chào, <b><%= user.toString() %></b></p>
      </div>
      <a href="LogoutServlet" class="btn-logout" style="text-decoration:none; color:inherit;">
        <i class="fas fa-sign-out-alt"></i> Đăng xuất
      </a>
    </header>

    <div class="container">
      <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('tables')">
          <i class="fas fa-chair"></i> Quản lý bàn
        </button>
        <button class="tab-btn" onclick="switchTab('food')">
          <i class="fas fa-utensils"></i> Quản lý món ăn
        </button>
        <button class="tab-btn" onclick="switchTab('bills')">
          <i class="fas fa-file-invoice-dollar"></i> Hóa đơn
        </button>
      </div>

      <section id="tables" class="section-content active">
        <h3 style="margin-bottom: 10px">Danh sách bàn</h3>
        <p style="color: #777; margin-bottom: 20px">Quản lý trạng thái các bàn</p>

        <div class="table-grid">
        <% 
            // Dùng vòng lặp Java để in danh sách bàn
            // Giả sử Object Table có: getId(), getName(), getStatus(), getOrderItems()
            /* Bỏ comment khi có Class Table:
            for(Table t : tableList) {
                String status = t.getStatus(); // "empty", "busy", "booked"
                String badgeClass = status;
                String statusText = status.equals("empty") ? "Trống" : (status.equals("busy") ? "Đang dùng" : "Đã đặt");
            */
            // --- MOCK LOGIC (Xóa đi khi dùng thật) ---
            for(int i=1; i<=6; i++) {
                String status = (i==2 || i==5) ? "busy" : "empty";
                String badgeClass = status;
                String statusText = status.equals("busy") ? "Đang dùng" : "Trống";
                int tableId = i;
                String tableName = "Bàn " + i;
            // ----------------------------------------
        %>
            <div class="table-card">
                <div class="table-header">
                    <b><%= tableName %></b>
                    <span class="badge <%= badgeClass %>"><%= statusText %></span>
                </div>
                
                <form action="UpdateTableServlet" method="GET">
                    <input type="hidden" name="tableId" value="<%= tableId %>">
                    <div style="margin-bottom: 5px; font-size:13px; font-weight:600;">Cập nhật:</div>
                    <select name="status" class="form-select" onchange="this.form.submit()">
                        <option value="empty" <%= status.equals("empty") ? "selected" : "" %>>Trống</option>
                        <option value="busy" <%= status.equals("busy") ? "selected" : "" %>>Đang dùng</option>
                        <option value="booked" <%= status.equals("booked") ? "selected" : "" %>>Đã đặt</option>
                    </select>
                </form>

                <% if(status.equals("busy")) { %>
                    <div class="order-summary">
                        <strong>Món đã gọi:</strong><br>
                        <span>... (Logic lấy chi tiết món) ...</span>
                        <span class="order-total">Tạm tính: ...đ</span>
                    </div>
                <% } %>
            </div>
        <% } %>
        </div>
      </section>

      <section id="food" class="section-content">
        <div class="toolbar">
          <div>
            <h3>Quản lý món ăn</h3>
            <p style="color: #777">Thêm, sửa, xóa món ăn</p>
          </div>
          
          <form action="AddFoodServlet" method="GET"> 
             <button class="btn-add"><i class="fas fa-plus"></i> Thêm món mới</button>
          </form>
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Tên món</th>
              <th>Giá</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <% 
                // Loop in ra món ăn
                /* for(Food f : foodList) { 
                */
                // --- MOCK LOOP ---
                for(int j=1; j<=5; j++) {
                    String fName = "Món Demo " + j;
                    int fPrice = 50000 * j;
                    int fId = j;
                // -----------------
            %>
            <tr>
                <td><%= fId %></td>
                <td style="font-weight:600;"><%= fName %></td>
                <td><%= fPrice %>đ</td>
                <td>
                    <form action="EditFoodPageServlet" method="GET" style="display:inline;">
                        <input type="hidden" name="id" value="<%= fId %>">
                        <button type="submit" class="action-btn"><i class="fas fa-edit"></i></button>
                    </form>
                    
                    <form action="DeleteFoodServlet" method="GET" style="display:inline;" onsubmit="return confirm('Xóa món này?');">
                        <input type="hidden" name="id" value="<%= fId %>">
                        <button type="submit" class="action-btn" style="color:red;"><i class="fas fa-trash"></i></button>
                    </form>
                </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </section>

      <section id="bills" class="section-content">
        <h3 style="margin-bottom: 10px">Thanh toán</h3>
        <p style="color: #777; margin-bottom: 20px">Các bàn đang hoạt động cần thanh toán</p>

        <div id="billList">
            <% 
                // Logic: Duyệt qua danh sách bàn, nếu bàn nào "busy" thì hiện hóa đơn
                /* for(Table t : tableList) { 
                    if(t.getStatus().equals("busy")) {
                */
                // --- MOCK ---
                for(int k=1; k<=6; k++) {
                   if(k == 2 || k == 5) { // Giả sử bàn 2, 5 đang bận
                       String bTableName = "Bàn " + k;
                       int totalBill = 200000; // Cần tính toán thực tế từ items
                // ------------
            %>
                <div class="bill-card">
                    <div class="bill-header">
                        <span><%= bTableName %></span>
                        <span class="badge busy">Chưa thanh toán</span>
                    </div>
                    
                    <div class="bill-item">
                        <span>Món Demo x 2</span>
                        <span>...đ</span>
                    </div>

                    <div class="bill-total">
                        <span>Tổng cộng:</span>
                        <span><%= totalBill %>đ</span>
                    </div>
                    
                    <form action="PayBillServlet" method="GET">
                        <input type="hidden" name="tableId" value="<%= k %>">
                        <input type="hidden" name="amount" value="<%= totalBill %>">
                        <button type="submit" class="btn-pay" onclick="return confirm('Xác nhận thanh toán cho <%= bTableName %>?')">
                            <i class="fas fa-money-bill-wave"></i> Xác nhận Thanh toán
                        </button>
                    </form>
                </div>
            <%     } 
               } 
            %>
        </div>
      </section>
    </div>

    <script>
      // --- CHỈ CÒN LOGIC CHUYỂN TAB (Dữ liệu đã được Java render) ---
      function switchTab(tabId) {
        document.querySelectorAll(".section-content").forEach((el) => el.classList.remove("active"));
        document.querySelectorAll(".tab-btn").forEach((el) => el.classList.remove("active"));
        document.getElementById(tabId).classList.add("active");
        event.currentTarget.classList.add("active");
      }
    </script>
  </body>
</html>