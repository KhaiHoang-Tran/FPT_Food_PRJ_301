CREATE TABLE [User] (
    userID INT IDENTITY(1,1) PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    [password] VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('user', 'manager', 'worker')),
    fullname NVARCHAR(100),
    phone VARCHAR(20),
    status VARCHAR(20) DEFAULT 'active'
        CHECK (status IN ('active', 'inactive'))
);

CREATE TABLE DiningTable (
    tableID INT IDENTITY(1,1) PRIMARY KEY,
    tableName NVARCHAR(50) NOT NULL,
    seatCount INT NOT NULL CHECK (seatCount > 0),
    status VARCHAR(20) DEFAULT 'empty'
        CHECK (status IN ('empty', 'busy', 'booked'))
);

CREATE TABLE Food (
    foodID INT IDENTITY(1,1) PRIMARY KEY,
    name NVARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL CHECK (price >= 0),
    category NVARCHAR(50),
    status VARCHAR(20) DEFAULT 'available'
        CHECK (status IN ('available', 'unavailable'))
);

CREATE TABLE Orders (
    orderID INT IDENTITY(1,1) PRIMARY KEY,
    tableID INT NOT NULL,
    status VARCHAR(20) DEFAULT 'pending'
        CHECK (status IN ('pending', 'cooking', 'done')),
    totalPrice DECIMAL(12,2) DEFAULT 0,
    createdTime DATETIME DEFAULT GETDATE(),

    CONSTRAINT FK_Orders_Table
        FOREIGN KEY (tableID) REFERENCES DiningTable(tableID)
);

CREATE TABLE OrderItem (
    orderItemID INT IDENTITY(1,1) PRIMARY KEY,
    orderID INT NOT NULL,
    foodID INT NOT NULL,
    quantity INT NOT NULL CHECK (quantity > 0),
    price DECIMAL(10,2) NOT NULL CHECK (price >= 0),

    CONSTRAINT FK_OrderItem_Order
        FOREIGN KEY (orderID) REFERENCES Orders(orderID)
        ON DELETE CASCADE,

    CONSTRAINT FK_OrderItem_Food
        FOREIGN KEY (foodID) REFERENCES Food(foodID)
);
